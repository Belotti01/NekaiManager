@page "/Logs"
@using Nekai.Common
@using NekaiManager.Components.Components
<PageTitle>Logs</PageTitle>

<MudStack Row>
    <OpenDirectoryButton Disabled="@(SelectedLogDirectory is null)" Directory="@SelectedLogDirectory" />
    <MudSelect Label="Choose a Program" T="PathString" ValueChanged="x => LoadLogs(x)">
        @foreach(var path in LogDirectories)
        {
            <MudSelectItem T="PathString" Value="path">@path.GetFileOrDirectoryName().ToString()</MudSelectItem>
        }
    </MudSelect>
</MudStack>

<MudDataGrid Items="Logs" AllowUnsorted Dense Hover>
    <PagerContent>
        <MudDataGridPager T="NekaiLog"></MudDataGridPager>
    </PagerContent>
    
    <Columns>
        <PropertyColumn Sortable="true" Property="x => x.TimeStamp" Title="Date"/>
        <PropertyColumn Sortable="true" Property="x => x.LogType" Title="Severity"/>
        <PropertyColumn Property="x => x.Message" Title="Message"/>
    </Columns>
</MudDataGrid>

@code {
    public PathString? SelectedLogDirectory { get; set; }
    public List<NekaiLog> Logs { get; private set; } = [];
    public static IEnumerable<PathString> LogDirectories => NekaiData.Directories.Logs.EnumerateDirectories(SearchOption.AllDirectories).Select(x => PathString.Parse(x));
    
    
    public void LoadLogs(PathString? path)
    {
        SelectedLogDirectory = path;
        if(SelectedLogDirectory is null)
        {
            Logs = [];
            return;
        }
        Logs = NekaiLogs.DeserializeAll(SelectedLogDirectory, true);
    }
}